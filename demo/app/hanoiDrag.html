<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta http-equiv="Expires" content="-1" />
    <meta http-equiv="pragram" content="no-cache" />
    <title>Document</title>
    <style>
        *{margin: 0; padding: 0;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}
        html,body{
            height: 100%;
        }
        body{
            font-size: 16px;
            color: #333;
            letter-spacing: 1px;
            -webkit-box-shadow: 0 0 1px #000;
            -moz-box-shadow: 0 0 1px #000;
            box-shadow: 0 0 1px #000;
            -webkit-user-select: none;
            -ms-user-select: none;
            -moz-user-select: none;
            -khtml-user-select: none;
            user-select: none;
            outline-style: none;
        }

        .clearfix{}
        .clearfix:after{
            display: block;
            content: "";
            clear: both;
            height: 0;
        }

        .app{
            width: 640px;
            height: 100%;
            margin: 0 auto;
        }

        .content{
            position: relative;
            width: 100%;
            height: 100%;
            /*background: #000 url(../images/m.jpg) 50% -150px no-repeat;*/
        }

        .page{
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            display: none;
        }

        .load{
            z-index: 1;
            padding-top: 350px;
            /*background: #000 url(../images/m.jpg) 50% -150px no-repeat;*/
        }

        .start{
            z-index: 10;
            /*background: #000 url(../images/m.jpg) 50% -150px no-repeat;*/
        }

        .start h1{
            color: #fff;
            font-size: 50px;
            font-weight: bold;
            text-align: center;
            padding-top: 350px;
            margin-bottom: 100px;
        }

        .start-btns{
            padding: 20px 0;
            text-align: center;

        }

        .start-btns button{
            display: inline-block;
            width: 100px;
            height: 100px;
            color: #fff;
            font-size: 40px;
            font-weight: bold;
            margin: 0 10px;
            border-radius: 60px;
            background: #f18200;
            border: none;
        }

        .play{
            z-index: 20;
            
        }

        .play-header{
            color: #000;
            font-size: 30px;
            padding: 10px 0;
            margin-bottom: 300px;
        }

        .play-header .pass{
            float: left;
            margin-left: 30px;
        }

        .play-header .step{
            float: right;
            margin-right: 30px;
        }


        .end{
            z-index: 30;
        }

        .share{
            z-index: 40;
        }

        .hanoi{
            position: relative;
            width: 100%;
            height: 200px;
        }

        .hanoi:after{
            position: absolute;
            bottom: -6px;
            left: 0;
            display: block;
            content: "";
            width: 100%;
            height: 6px;
            background: #f60;
        }

        .pillar{
            position: absolute;
            bottom: 0;
            width: 100px;
            height: 80%;
            margin-left: -50px;
            background: #f60;
        }

        .pillar:nth-of-type(1){
            left: 25%;
        }

        .pillar:nth-of-type(2){
            left: 50%;
        }

        .pillar:nth-of-type(3){
            left: 75%;
        }

        .disk{
            position: absolute;
            width: 50px;
            height: 20px;
            bottom: 0;
            left: 50px;
            margin-left: -25px;
            background-color: #f1a165;
                    background-image: -moz-linear-gradient(top, #f1a165, #f36d0a);
                    background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f1a165),color-stop(1, #f36d0a));
                    background-image: -webkit-linear-gradient(#f1a165, #f36d0a); 
        }

        .disk1 {
            bottom: 0;
            width: 110%;
            margin-left: -55%;
        }

        .disk2 {
            bottom: 20px;
            width: 100%;
            margin-left: -50%;
        }

        .disk3 {
            bottom: 40px;
            width: 90%;
            margin-left: -45%;
        }

        .disk4 {
            bottom: 60px;
            width: 1000%;
            margin-left: -500%;
        }

        .disk5 {
            bottom: 80px;
            width: 800%;
            margin-left: -400%;
        }

        .disk6 {
            bottom: 100px;
            width: 600%;
            margin-left: -300%;
        }

        .disk7 {
            bottom: 120px;
            width: 400%;
            margin-left: -200%;
        }

        .disk-check{
            background-color: #f0a3a3;
            background-image: -moz-linear-gradient(top, #f0a3a3, #f42323);
            background-image: -webkit-gradient(linear,left top,left bottom,color-stop(0, #f0a3a3),color-stop(1, #f42323));
            background-image: -webkit-linear-gradient(#f0a3a3, #f42323);
        }


        .group-btns{
            position: relative;
        }

        .group-btns button{
            position: absolute;
            top: 6px;
            width: 60px;
            height: 60px;
            margin-left: -30px;
            border: none;
            background: #f60;
            border-radius: 10px;
        }




        .group-btns button:nth-of-type(1){
            left: 25%;
        }

        .group-btns button:nth-of-type(2){
            left: 50%;
        }

        .group-btns button:nth-of-type(3){
            left: 75%;
        }


         .ball {
            background-color: rgba(0,0,0,0);
            border:5px solid rgba(0,183,229,0.9);
            opacity:.9;
            border-top:5px solid rgba(0,0,0,0);
            border-left:5px solid rgba(0,0,0,0);
            border-radius:50px;
            box-shadow: 0 0 35px #2187e7;
            width:100px;
            height:100px;
            margin:0 auto;
            -moz-animation:spin .5s infinite linear;
            -webkit-animation:spin .5s infinite linear;
        }

        .ball1 {
            background-color: rgba(0,0,0,0);
            border:5px solid rgba(0,183,229,0.9);
            opacity:.9;
            border-top:5px solid rgba(0,0,0,0);
            border-left:5px solid rgba(0,0,0,0);
            border-radius:50px;
            box-shadow: 0 0 15px #2187e7; 
            width:70px;
            height:70px;
            margin:0 auto;
            position:relative;
            top:-85px;
            -moz-animation:spinoff .5s infinite linear;
            -webkit-animation:spinoff .5s infinite linear;
        }

        @-moz-keyframes spin {
            0% { -moz-transform:rotate(0deg); }
            100% { -moz-transform:rotate(360deg); }
        }
        @-moz-keyframes spinoff {
            0% { -moz-transform:rotate(0deg); }
            100% { -moz-transform:rotate(-360deg); }
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform:rotate(0deg); }
            100% { -webkit-transform:rotate(360deg); }
        }
        @-webkit-keyframes spinoff {
            0% { -webkit-transform:rotate(0deg); }
            100% { -webkit-transform:rotate(-360deg); }
        }
    </style>
    <script>
        (function () {
            if(/Android (\d+\.\d+)/.test(navigator.userAgent)){
                var version = parseFloat(RegExp.$1);
                if(version>2.3){
                    var phoneScale = parseInt(window.screen.width)/640;
                    document.write('<meta name="viewport" content="width=640, minimum-scale = '+ phoneScale +', maximum-scale = '+ phoneScale +', target-densitydpi=device-dpi">');
                }else{
                    document.write('<meta name="viewport" content="width=640, target-densitydpi=device-dpi">');
                }
            }else{
                document.write('<meta name="viewport" content="width=640, user-scalable=no, target-densitydpi=device-dpi">');
            }
            //微信去掉下方刷新栏
            if(navigator.userAgent.indexOf('MicroMessenger') >= 0){
                document.addEventListener('WeixinJSBridgeReady', function() {
                    //WeixinJSBridge.call('hideToolbar');
                });
            }
        })();
    </script>
</head>
<body class="app">
    <div class="content">
        <div style="padding:100px 0 0;">ceshi</div>
        <div class="hanoi" style="background: #f00;">
            <div class="pillar">
                <span class="disk disk1"></span>
                <span class="disk disk2"></span>
                <span class="disk disk3"></span>
            </div>
            <div class="pillar"></div>
            <div class="pillar"></div>
            <!-- <div class="demo" style="position: absolute; top: 50px; left: 100px;width: 20px; height: 20px; border-radius: 20px; background: #f0f;"></div> -->
        </div>
    </div>

    <script src="../../plugs/zepto/zepto.js"></script>
    <script src="../../plugs/zepto/selector.js"></script>
    <script src="../../plugs/zepto/event.js"></script>
    <script src="../../plugs/zepto/touch.js"></script>
    <script>
        function mousePos(e) {
            if (typeof e.offsetX != 'undefined' && typeof e.offsetY != 'undefined') {
                currentX = e.offsetX;
                currentY = e.offsetY;
            } else {
                var relPos = getRelativePos(e.clientX, e.clientY);
                currentX = relPos[0];
                currentY = relPos[1];
            }
            return {
                x: currentX,
                y: currentY
            };
        }

        function getRelativePos(x, y) {
            var curleft = curtop = 0;
            var scrollLeft = document.body.scrollLeft,
                scrollTop = document.body.scrollTop;
            var obj = this.scratch;
            if (obj && obj.offsetParent) {
                do {
                    curleft += obj.offsetLeft;
                    curtop += obj.offsetTop;
                } while (obj = obj.offsetParent);
            }
            scrollLeft = scrollLeft > 0 ? scrollLeft : document.documentElement.scrollLeft;
            scrollTop = scrollTop > 0 ? scrollTop : document.documentElement.scrollTop;
            return [(x - curleft + scrollLeft), (y - curtop + scrollTop)];
        }

        var isMobile = /ipad|iphone|midp|ucweb|android|mobile/ig.test(navigator.userAgent);
        var touchStart = isMobile ? "touchstart" : "mousedown",
            touchEnd = isMobile ? "touchend" : "mouseup",
            touchMove = isMobile ? "touchmove" : "mousemove",
            tap = isMobile ? "tap" : "click";


        var disk = [
            [],
            [],
            []
        ];

        var max = 3;

        var firstArr = [];

        var stepNumber = 0;

        for (var i = 0; i < this.max; i++) {
            disk[0].push((i + 1));
        }

         // console.log(disk);

        var elemX = null;
        var elemY = null;

        var isMoving = false;


        var pillar = $(".pillar").eq(0).position();
         //console.log(pillar.top, pillar.left );

        var pillars = [{
            pX: null,
            pY: null
        }, {
            pX: null,
            pY: null
        }, {
            pX: null,
            pY: null
        }];
        var pillarSize = {
            w: null,
            h: null
        };

        pillars[0].pY = $(".pillar").eq(0).position().top;
        pillars[0].pX = $(".pillar").eq(0).position().left;
        pillars[1].pY = $(".pillar").eq(1).position().top;
        pillars[1].pX = $(".pillar").eq(1).position().left;
        pillars[2].pY = $(".pillar").eq(2).position().top;
        pillars[2].pX = $(".pillar").eq(2).position().left;

        pillarSize.w = $(".pillar").eq(0).width();
        pillarSize.h = $(".pillar").eq(0).height();

        var pIndex = null;
        var acHtml = "";

         

        $(".pillar").on(touchStart, function(e) {
            e.stopPropagation();
              e.preventDefault();
            
            var $this = $(this);
            pIndex = $(this).index();

           

            $(".disk-check").remove();
            var tmp = $(".pillar").eq(pIndex).find(".disk");
            var len = tmp.length;
            var tmpLast = tmp.last();
            var tmpLastW = tmpLast.width();
            var tmpLastH = tmpLast.height();
            acHtml = "<span class ='" + tmpLast.attr("class") + "'></span>";

            var tmpLastPos = tmpLast.position();

            



            var tmpHtml = "<div class='demo' style='position:absolute; left: " + (pillars[pIndex].pX + (pillarSize.w - tmpLastW) / 2) + "px; top: " + (pillars[pIndex].pY + tmpLastPos.top) + "px; width: " + tmpLastW + "px; height: " + tmpLastH + "px; background: #000; margin-left: -50px;'></div>";
            $(".hanoi").append(tmpHtml);

            tmpLast.hide().addClass("disk-check");
            isMoving = true;


        });





        var gX = null;
        var gY = null;

        $(".hanoi").on(touchMove, function(e) {
            

            var pos = $(this)[0].getBoundingClientRect();
            //console.log(mousePos(e).x,pos.top);
            //console.log(e.touches[0].pageX,e.touches[0].pageY);

            e.stopPropagation();
                e.preventDefault();

            if (isMoving) {
                console.log("move........");
                


                if(!!e.touches){
                   gX =  e.touches[0].pageX - pos.left;
                     gY = e.touches[0].pageY - pos.top;
                } else{
                    gY = e.pageY - pos.top;
                gX = e.pageX - pos.left;
                }

                console.log(gX,gY,pillars);
                

                $(".demo").css({
                    "top": (gY) + "px",
                    "left": (gX) + "px"
                });


            }
        });



        $(document).on(touchEnd,  function(e) {
            isMoving = false;
            console.log("up........");
            e.stopPropagation();
            e.preventDefault();



            gX = gX + 50;

            var isGood = false;

            if (pillars[0].pX < gX && gX < (pillars[0].pX + pillarSize.w) && pillars[0].pY < gY && gY < (pillars[0].pY + pillarSize.h)) {
                var index = 0;
                var len = $(".pillar").eq(0).find(".disk").length;
                var plen = disk[pIndex].length;
                var slen = disk[index].length;

                console.log(disk);

                if ((disk[pIndex][plen - 1] > disk[index][slen - 1]) || disk[index][slen - 1] === undefined) {
                    $(".pillar").eq(0).append(acHtml);


                    $(".pillar").eq(0).find(".disk").last().css({
                        bottom: ((len) * 20) + "px"
                    });

                     var pVal = disk[pIndex].pop();
                    disk[index].push(pVal);

                    $(".hanoi").find(".demo").remove();

                    acHtml = "";
                    isGood = true;
                }
            }

            if (pillars[1].pX < gX && gX < (pillars[1].pX + pillarSize.w) && pillars[1].pY < gY && gY < (pillars[1].pY + pillarSize.h)) {

                var index = 1;

                var len = $(".pillar").eq(1).find(".disk").length;
                var plen = disk[pIndex].length;
                var slen = disk[index].length;

                console.log(disk);

                if ((disk[pIndex][plen - 1] > disk[index][slen - 1]) || disk[index][slen - 1] === undefined) {
                    $(".pillar").eq(1).append(acHtml);


                    $(".pillar").eq(1).find(".disk").last().css({
                        bottom: ((len) * 20) + "px"
                    });

                    var pVal = disk[pIndex].pop();
                    disk[index].push(pVal);

                    $(".hanoi").find(".demo").remove();

                    acHtml = "";
                    isGood = true;
                }
            }


            if (pillars[2].pX < gX && gX < (pillars[2].pX + pillarSize.w) && pillars[2].pY < gY && gY < (pillars[2].pY + pillarSize.h)) {
                var index = 2;
                var len = $(".pillar").eq(2).find(".disk").length;
                var plen = disk[pIndex].length;
                var slen = disk[index].length;

                console.log(disk);

                if ((disk[pIndex][plen - 1] > disk[index][slen - 1]) || disk[index][slen - 1] === undefined) {
                    $(".pillar").eq(2).append(acHtml);


                    $(".pillar").eq(2).find(".disk").last().css({
                        bottom: ((len) * 20) + "px"
                    });

                     var pVal = disk[pIndex].pop();
                    disk[index].push(pVal);

                    $(".demo").remove();

                    acHtml = "";
                    isGood = true;
                }
            }


            if(!isGood){
                $(".disk-check").show().removeClass("disk-check");
                 $(".demo").remove();
                 acHtml = "";
            }

        });
    </script>
</body>
</html>